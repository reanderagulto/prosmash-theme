{{ "mdp-weare-news-1.css" | asset_url | stylesheet_tag }}

<div id="mdp-weare-{{ section.id }}"
     class="mdp mdp-weare-news-1"
     data-variant="{{ section.settings.variant }}"
     style="{% if section.settings.bg_color != blank %}background-color: {{ section.settings.bg_color }};{% endif %}
             padding-top: {{ section.settings.padding_top }}px;
             padding-bottom: {{ section.settings.padding_bottom }}px;
     {% if section.settings.margin_top != blank %}margin-top: {{ section.settings.margin_top }}px;{% endif %}
             {% if section.settings.margin_bottom != blank %}margin-bottom: {{ section.settings.margin_bottom }}px;{% endif %}">
    {% if section.settings.bg_image != blank %}
        <div class="mdp-overlay lazyload" data-bgset="{{ section.settings.bg_image | img_url: '2000x' }}"></div>
    {% endif %}
    <div id="mdp-weare-news-container-{{ section.id }}"
         class="{% if section.settings.boxed == true %}mdp-container{% else %}mdp-boxed{% endif %}">
        {% if section.settings.title != blank or section.settings.subtitle != blank %}
            <div class="mdp-header">
                {% if section.settings.title != blank %}
                    <h2 class="mdp-title">{{ section.settings.title | escape }}</h2>
                {% endif %}

                {% if section.settings.subtitle != blank %}
                    <div class="mdp-subtitle">{{ section.settings.subtitle | escape }}</div>
                {% endif %}
            </div>
        {% endif %}
        {% assign blog = blogs[section.settings.blog] %}
        {% paginate blog.articles by section.settings.limit %}
            <div id="mdp-weare-news-{{ section.id }}"
                 class="mdp-grid"
                 data-columns="{{ section.settings.col_per_row }}"
                 data-gap="{{ section.settings.gap }}">
                {% for article in blog.articles %}
                    <div class="mdp-item">
                        {% if article.image != blank %}
                            <div class="mdp-media">
                                <a href="{{ article.url }}">
                                    <img class="mdp-image-news"
                                         src="{{ article.image | img_url: section.settings.image_size }}"
                                         alt="{{ article.title }}">
                                    {% if section.settings.variant == "style_4" %}
                                        <h3 class="mdp-article-title">{{ article.title }}</h3>
                                    {% endif %}
                                </a>
                            </div>
                        {% endif %}
                        <div class="mdp-data">
                            <div class="mdp-header">
                                <div class="mdp-extra">
                                    <div class="mdp-date">
                                        {{ article.published_at | time_tag: format: 'date' }}
                                    </div>
                                    <div class="mdp-tags">
                                        {% for tag in article.tags %}
                                            <a href="/blogs/{{ blog.handle }}/tagged/{{ tag | handleize }}">{{ tag }}</a>
                                        {% endfor %}
                                    </div>
                                </div>
                                <h3 class="mdp-title">
                                    <a href="{{ article.url }}">{{ article.title }}</a>
                                </h3>

                            </div>

                            {% if article.content != blank %}
                                <div class="mdp-content">
                                    {{ article.content | strip_html | truncatewords: section.settings.excerpt_words, section.settings.excerpt_ellipsis }}
                                </div>
                            {% endif %}

                            {% if section.settings.show_read_more == true %}
                                <div class="mdp-footer">
                                    <a class="mdp-button" href="{{ article.url }}">
                                        <span class="mdp-text">{{ section.settings.read_more_string }}</span>
                                        <span class="mdp-icon">{% render 'mdp-weare-icon' with '003' %}</span>
                                    </a>
                                </div>
                            {% endif %}

                        </div>
                    </div>
                {% endfor %}
            </div>
            {% if template.name == 'blog' and paginate.pages > 1 %}
                {% render 'mdp-weare-pagination', paginate: paginate %}
            {% endif %}
        {% endpaginate %}
    </div>
</div>

<script>
    {% if request.design_mode == true %}
    function designModeGrid() {
        let slider_{{ section.id | replace: "--", "" | replace: "-", "" }} = document.querySelector("#mdp-weare-news-{{ section.id }}");
        let data_{{ section.id | replace: "--", "" | replace: "-", "" }} = slider_{{ section.id | replace: "--", "" | replace: "-", "" }}.getAttribute('data-columns') || {};
        let dataOptions = JSON.parse(data_{{ section.id | replace: "--", "" | replace: "-", "" }});

        /** Calculate the height of the image depending on the length of the container */
        function breakpointsWidthCol_{{ section.id | replace: "--", "" | replace: "-", "" }}(width) {

            let perView = dataOptions;

            if (width >= 769 && width <= 1024) {
                perView = 3;
            }

            if (width >= 426 && width <= 768) {
                perView = 2;
            }

            if (width >= 320 && width <= 425) {
                perView = 1;
            }

            return perView;
        }

        function heightImgCol_{{ section.id | replace: "--", "" | replace: "-", "" }}() {
            let winWidthPage = window.innerWidth;
            let grid = document.getElementById("mdp-weare-news-container-{{ section.id }}");
            let winWidth = grid.offsetWidth;
            let perView = breakpointsWidthCol_{{ section.id | replace: "--", "" | replace: "-", "" | replace: "-", "" }}(winWidthPage);
            let allGap = winWidthPage >= 376 ? perView * 15 : 0;
            let paddingSide = '{{ section.settings.boxed }}' === 'false' && winWidthPage >= 1025 ? 80 * 2 : 15 * 2;
            let winWidthGap = winWidth - allGap - paddingSide;
            let colSize = 100 / perView;
            let height = (winWidthGap * colSize / 100) + {{ section.settings.images_form }};
            let item = grid.querySelectorAll(".mdp-image-news");

            for (let i = 0; i <= item.length - 1; i++) {
                if( i === 0 && perView === 2 && {{ section.settings.big_image_news }} == true){
                    item[i].setAttribute("style", `height: calc(${Math.round(height)}px * 2);`);
                }else if(i === 0 && perView === 2 && {{ section.settings.big_image_news }} == false){
                    item[i].setAttribute("style", `height: calc(${Math.round(height)}px);`);
                }
                else {
                    item[i].setAttribute("style", `height: calc(${Math.round(height)}px / {{ section.settings.reduces_form }});`);
                }
            }
        }

        addEventListener("resize", (event) => {
            heightImgCol_{{ section.id | replace: "--", "" | replace: "-", "" }}();
        });

        heightImgCol_{{ section.id | replace: "--", "" | replace: "-", "" }}();
        /** End */
    }

    document.addEventListener("shopify:section:load", designModeGrid);
    {% endif %}

    let slider_{{ section.id | replace: "--", "" | replace: "-", "" }} = document.querySelector("#mdp-weare-news-{{ section.id }}");
    let data_{{ section.id | replace: "--", "" | replace: "-", "" }} = slider_{{ section.id | replace: "--", "" | replace: "-", "" }}.getAttribute('data-columns') || {};
    let dataOptions_{{ section.id | replace: "--", "" | replace: "-", "" }} = JSON.parse(data_{{ section.id | replace: "--", "" | replace: "-", "" }});

    /** Calculate the height of the image depending on the length of the container */
    function breakpointsWidthCol_{{ section.id | replace: "--", "" | replace: "-", "" }}(width) {

        let perView = dataOptions_{{ section.id | replace: "--", "" | replace: "-", "" }};

        if (width >= 769 && width <= 1024) {
            perView = 3;
        }

        if (width >= 426 && width <= 768) {
            perView = 2;
        }

        if (width >= 320 && width <= 425) {
            perView = 1;
        }

        return perView;
    }

    function heightImgCol_{{ section.id | replace: "--", "" | replace: "-", "" }}() {
        let winWidthPage = window.innerWidth;
        let grid = document.getElementById("mdp-weare-news-container-{{ section.id }}");
        let winWidth = grid.offsetWidth;
        let perView = breakpointsWidthCol_{{ section.id | replace: "--", "" | replace: "-", "" | replace: "-", "" }}(winWidthPage);
        let allGap = winWidthPage >= 376 ? perView * 15 : 0;
        let paddingSide = '{{ section.settings.boxed }}' === 'false' && winWidthPage >= 1025 ? 80 * 2 : 15 * 2;
        let winWidthGap = winWidth - allGap - paddingSide;
        let colSize = 100 / perView;
        let height = (winWidthGap * colSize / 100) + {{ section.settings.images_form }};
        let item = grid.querySelectorAll(".mdp-image-news");

        for (let i = 0; i <= item.length - 1; i++) {
            if( i === 0 && perView === 2 && {{ section.settings.big_image_news }} == true){
                item[i].setAttribute("style", `height: calc(${Math.round(height)}px * 2);`);
            }else if(i === 0 && perView === 2 && {{ section.settings.big_image_news }} == false){
                item[i].setAttribute("style", `height: calc(${Math.round(height)}px);`);
            }
            else {
                item[i].setAttribute("style", `height: calc(${Math.round(height)}px / {{ section.settings.reduces_form }});`);
            }
        }
    }

    addEventListener("resize", (event) => {
        heightImgCol_{{ section.id | replace: "--", "" | replace: "-", "" }}();
    });

    heightImgCol_{{ section.id | replace: "--", "" | replace: "-", "" }}();
    /** End */
</script>

{% schema %}
{
  "name": "Blog",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "News grid"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Subheading"
    },
    {
      "id": "blog",
      "type": "blog",
      "label": "Blog"
    },
    {
      "type": "range",
      "id": "limit",
      "label": "Limit",
      "default": 9,
      "min": 2,
      "max": 20,
      "step": 1
    },
    {
      "type": "range",
      "id": "col_per_row",
      "label": "Col per row",
      "default": 3,
      "min": 2,
      "max": 5,
      "step": 1
    },
    {
      "type": "select",
      "id": "gap",
      "label": "Gap(px)",
      "default": "30",
      "options": [
        {
          "label": "0",
          "value": "0"
        },
        {
          "label": "1",
          "value": "1"
        },
        {
          "label": "2",
          "value": "2"
        },
        {
          "label": "3",
          "value": "3"
        },
        {
          "label": "4",
          "value": "4"
        },
        {
          "label": "5",
          "value": "5"
        },
        {
          "label": "10",
          "value": "10"
        },
        {
          "label": "15",
          "value": "15"
        },
        {
          "label": "20",
          "value": "20"
        },
        {
          "label": "25",
          "value": "25"
        },
        {
          "label": "30",
          "value": "30"
        }
      ]
    },
    {
      "type": "text",
      "id": "images_form",
      "label": "Images form",
      "default": "50",
      "info": "If the shape of the image does not suit you in terms of height, enter in the field the number of pixels by which the desired height will increase."
    },
    {
      "type": "text",
      "id": "reduces_form",
      "label": "Reduces images",
      "info": "Reduces the image by the specified number of times."
    },
    {
      "type": "checkbox",
      "id": "big_image_news",
      "label": "Big image",
      "info": " First news big image for mobile devices"
    },
    {
      "type": "text",
      "id": "image_size",
      "label": "Image size",
      "default": "600x400_crop_center",
      "info": "Set the image size: '600x600',\n '2048x',\n'original' or '370x370_crop_center'"
    },
    {
      "type": "image_picker",
      "id": "bg_image",
      "label": "Background image"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background color"
    },
    {
      "type": "checkbox",
      "id": "boxed",
      "label": "Boxed",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_read_more",
      "label": "Show read more",
      "default": false
    },
    {
      "type": "text",
      "id": "read_more_string",
      "label": "Read more text",
      "default": "Read more"
    },
    {
      "type": "range",
      "id": "excerpt_words",
      "label": "Excerpt words number",
      "default": 20,
      "min": 5,
      "max": 100,
      "step": 5
    },
    {
      "type": "text",
      "id": "excerpt_ellipsis",
      "label": "Excerpt ellipsis",
      "default": "..."
    },
    {
      "type": "select",
      "id": "variant",
      "label": "Variant",
      "default": "style_1",
      "options": [
        {
          "label": "Style 1",
          "value": "style_1"
        },
        {
          "label": "Style 2",
          "value": "style_2"
        },
        {
          "label": "Style 3",
          "value": "style_3"
        },
        {
          "label": "Style 4",
          "value": "style_4"
        }
      ]
    },
    {
      "type": "text",
      "id": "padding_top",
      "label": "Padding top (px)"
    },
    {
      "type": "text",
      "id": "padding_bottom",
      "label": "Padding bottom (px)"
    },
    {
      "type": "text",
      "id": "margin_top",
      "label": "Margin top (px)"
    },
    {
      "type": "text",
      "id": "margin_bottom",
      "label": "Margin bottom (px)"
    }
  ],
  "presets": [
    {
      "name": "News",
      "category": "SectionHub: weare"
    }
  ]
}
{% endschema %}