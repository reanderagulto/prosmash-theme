<section class="prosmash-collection-grid">
  <div class="mdp-container">
    <div class="filter-section">
      <div class="custom-container">
        <div class="col-left">
            <div class="collection-title">{{ collection.title }} ({{ collection.products_count }})</div>
        </div>
        <div class="col-right">
          <div class="filter-container">
            {% render 'faceted-filter' %}
          </div>
        </div>
      </div>
    </div>
    <div id="CollectionProductGrid">
      <div class="collection-grid">
        {% for product in collection.products %}
          {% render 'prosmash-product-card', product: product %}
        {% endfor %}
      </div>
    </div>
  </div>
</section>

<style>



.collection-grid {
    display: flex;
    align-items: flex-start;
    gap: 40px;
    align-self: stretch;
    flex-wrap: wrap;
    justify-content: center;
}



</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
  const form = document.querySelector('#CollectionFiltersForm');
  const productGrid = document.querySelector('#CollectionProductGrid');

  if (!form) return;

  form.addEventListener('change', function (e) {
    e.preventDefault();

    const formData = new FormData(form);
    const searchParams = new URLSearchParams(formData).toString();

    // The magic: reload this section via Section Rendering API
    fetch(`${window.location.pathname}?section_id=prosmash-collection-grid&${searchParams}`)
      .then(response => response.text())
      .then(responseText => {
        const parser = new DOMParser();
        const html = parser.parseFromString(responseText, 'text/html');
        const newGrid = html.querySelector('#CollectionProductGrid');
        if (newGrid) {
          productGrid.innerHTML = newGrid.innerHTML;
          window.history.replaceState({}, '', `${window.location.pathname}?${searchParams}`);
        }
      });
  });
});

</script>



{% schema %}
  {
    "name": "Collection Grid",
    "settings": [

    ],	
    "presets": [{
      "name": "Prosmash Collection Grid",
      "category": "Prosmash: Collection"
    }]
  }
{% endschema %}